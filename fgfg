-- Delta MM2 Auto-Spam + FIXED lk_serverhop (–ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ—Ç –∂–µ —Å–µ—Ä–≤–µ—Ä!)
-- –†–∞–±–æ—Ç–∞–µ—Ç –≤ TextChatService + Legacy —á–∞—Ç | –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–∏—è

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local TextChatService = game:GetService("TextChatService")
local player = Players.LocalPlayer
local placeId = game.PlaceId

if placeId ~= 142823291 then
    warn("‚ùå –≠—Ç–æ –Ω–µ MM2!")
    return
end

getgenv().AutoSpamEnabled = true

local messages = {
    "üíé –ü—Ä–æ–¥–∞–º Godly –¥–µ—à–µ–≤–æ –∑–∞ –≥—Ä–Ω. Hexon_Shop",
    "üî• Godly –∑–∞ –≥—Ä–∏–≤–Ω—ã. –ë—ã—Å—Ç—Ä–æ. Hexon_Shop",
    "üí∞ –ö—É–ø–∏—Ç—å Godly –Ω–µ–¥–æ—Ä–æ–≥–æ. Hexon_Shop",
    "üéÆ Godly –ø–æ –≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ. Hexon_Shop",
    "‚≠ê Godly –¥–ª—è —Ç—Ä–µ–π–¥–∞. Hexon_Shop",
    "‚ö° –î–µ—à–µ–≤—ã–π Godly –∑–∞ –≥—Ä–Ω. Hexon_Shop",
    "üîî –ü—Ä–æ–¥–∞–∂–∞ Godly. Hexon_Shop",
    "‚ú® Godly –≤ –Ω–∞–ª–∏—á–∏–∏. Hexon_Shop",
    "üöÄ –ü–æ–∫—É–ø–∞–π Godly. Hexon_Shop",
    "üíØ Godly –ø–æ –Ω–∏–∑–∫–æ–π —Ü–µ–Ω–µ. Hexon_Shop"
}

local function shuffle(tbl)
    for i = #tbl, 2, -1 do
        local j = math.random(i)
        tbl[i], tbl[j] = tbl[j], tbl[i]
    end
    return tbl
end

local function sendMessage(text)
    -- Legacy —á–∞—Ç
    pcall(function()
        game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(text, "All")
    end)
    -- –ù–æ–≤—ã–π TextChatService
    pcall(function()
        if TextChatService.TextChannels:FindFirstChild("RBXGeneral") then
            TextChatService.TextChannels.RBXGeneral:SendAsync(text)
        end
    end)
    print("üì¢ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: " .. string.sub(text, 1, 30) .. "...")
end

-- FIXED lk_serverhop.lua (–¥–æ–±–∞–≤–ª–µ–Ω skip —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞!)
local function serverHop()
    print("üîÑ FIXED Server Hop (lk_serverhop + skip current)...")
    
    if queue_on_teleport then
        queue_on_teleport([[
            getgenv().AutoStartSpam = true
            task.wait(5)
            loadstring(game:HttpGet("https://raw.githubusercontent.com/scriptixrbx/efeded/refs/heads/main/fgfg"))()
        ]])
    end
    
    local AllIDs = {}
    local foundAnything = ""
    local actualHour = os.date("!*t").hour
    local S_T = TeleportService
    local S_H = HttpService
    
    local File = pcall(function()
        AllIDs = S_H:JSONDecode(readfile("server-hop-temp.json"))
    end)
    if not File then
        table.insert(AllIDs, actualHour)
        writefile("server-hop-temp.json", S_H:JSONEncode(AllIDs))
    end
    
    local function TPReturner()
        local Site
        if foundAnything == "" then
            Site = S_H:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. placeId .. '/servers/Public?sortOrder=Asc&limit=100'))
        else
            Site = S_H:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. placeId .. '/servers/Public?sortOrder=Asc&limit=100&cursor=' .. foundAnything))
        end
        if Site.nextPageCursor and Site.nextPageCursor ~= "null" and Site.nextPageCursor ~= nil then
            foundAnything = Site.nextPageCursor
        end
        local num = 0
        for i, v in pairs(Site.data) do
            local Possible = true
            local ID = tostring(v.id)
            -- ‚úÖ –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: skip —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä + –ø–æ–ª–Ω—ã–µ
            if tonumber(v.maxPlayers) > tonumber(v.playing) and ID ~= game.JobId then
                for _, Existing in pairs(AllIDs) do
                    if num ~= 0 then
                        if ID == tostring(Existing) then
                            Possible = false
                            break
                        end
                    else
                        if tonumber(actualHour) ~= tonumber(Existing) then
                            pcall(function()
                                delfile("server-hop-temp.json")
                                AllIDs = {}
                                table.insert(AllIDs, actualHour)
                            end)
                        end
                    end
                    num += 1
                end
                if Possible then
                    table.insert(AllIDs, ID)
                    writefile("server-hop-temp.json", S_H:JSONEncode(AllIDs))
                    S_T:TeleportToPlaceInstance(placeId, ID, player)
                    task.wait(4)
                    return true
                end
            end
        end
        return false
    end
    
    while task.wait(0.5) do
        if TPReturner() then break end
        if foundAnything == "" then break end
    end
    return true
end

local function mainLoop()
    print("ü§ñ –°–ø–∞–º + FIXED Hop –∑–∞–ø—É—â–µ–Ω! üöÄ")
    local cycle = 0
    while getgenv().AutoSpamEnabled do
        cycle += 1
        print("\n=== #" .. cycle .. " ===")
        
        -- –ñ–¥—ë–º —á–∞—Ç (15 —Å–µ–∫ –º–∞–∫—Å)
        for i = 1, 15 do
            local legacyChat = game:GetService("ReplicatedStorage"):FindFirstChild("DefaultChatSystemChatEvents")
            local newChat = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
            if legacyChat or newChat then
                print("‚úÖ –ß–∞—Ç –≥–æ—Ç–æ–≤")
                break
            end
            if i == 15 then
                print("‚ö†Ô∏è –ß–∞—Ç timeout ‚Üí Hop")
                serverHop()
                task.wait(10)
                continue
            end
            task.wait(1)
        end
        
        -- 5 —Å–æ–æ–±—â–µ–Ω–∏–π
        local shuffled = shuffle(messages)
        for i = 1, 5 do
            if not getgenv().AutoSpamEnabled then break end
            sendMessage(shuffled[i])
            if i < 5 then task.wait(math.random(3, 5)) end
        end
        
        -- Hop
        task.wait(1)
        serverHop()
        print("‚úÖ Hop OK, –∂–¥—É...")
        task.wait(15)
    end
end

print("========================================")
print("ü§ñ MM2 DELTA SPAM + LK SERVERHOP FIXED")
print("üì¢ 5 msg ‚Üí Hop (–ù–ï —Ç–æ—Ç –∂–µ —Å–µ—Ä–≤–µ—Ä!)")
print("========================================")

task.wait(3)

if getgenv().AutoStartSpam then
    pcall(mainLoop)
else
    serverHop()  -- –ü–µ—Ä–≤—ã–π hop —Å—Ä–∞–∑—É
end

getgenv().StopSpam = function() getgenv().AutoSpamEnabled = false print("‚èπÔ∏è Stop") end
print("‚úÖ –ó–∞–ø—É—â–µ–Ω–æ! StopSpam()")
